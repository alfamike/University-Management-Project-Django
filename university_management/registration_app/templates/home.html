{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<h1>Welcome to the University Management System</h1>
<p>This is the dashboard where you can manage university data.</p>

<!-- Chatbot UI -->
<div class="chatbox">
    <div class="chat-container" id="chat-container" aria-live="polite">
        <!-- Chat messages will appear here -->
    </div>
    <input id="user-input" placeholder="Type a message..." type="text"/>
    <button id="send-btn">Send</button>
</div>

<script>
    // Get DOM elements
    const sendButton = document.getElementById('send-btn');
    const userInput = document.getElementById('user-input');
    const chatContainer = document.getElementById('chat-container');

    // Function to send the user message to the server
    function sendMessage() {
        const message = userInput.value;
        if (!message) return; // Don't send empty messages

        // Append user message to chat container
        chatContainer.innerHTML += `<div class="user-message">${message}</div>`;
        scrollToBottom();

        userInput.value = ''; // Clear input box

        // Get CSRF token from the document
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // Send message to the Django server using AJAX (fetch API)
        fetch('/chat/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken,
            },
            body: JSON.stringify({ message: message }),
        })
        .then(response => response.json())
        .then(data => {
            // Append server response to chat container
            chatContainer.innerHTML += `<div class="bot-message">${data.response}</div>`;
            scrollToBottom();
        })
        .catch(error => {
    console.error('Error:', error);
    chatContainer.innerHTML += `<div class="bot-message">Sorry, there was an issue processing your message. Please try again later.</div>`;
    scrollToBottom();
});

    }

    // Attach event listener to send button
    sendButton.addEventListener('click', sendMessage);

    // Optionally, allow pressing "Enter" to send the message
    userInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    });

    // Scroll to the bottom of the chat container
function scrollToBottom() {
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

</script>

<style>
    /* Chatbot styles */
    .chatbox {
        position: fixed;
        bottom: 20px;
        left: 250px;
        width: calc(80% - 250px); /* Adjust width based on sidebar */
        max-width: calc(100% - 250px); /* Max width */
        padding: 20px;
        border-radius: 8px;
        background-color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }

    .chat-container {
        max-height: 600px;
        overflow-y: auto;
        margin-bottom: 10px;
        flex-grow: 1;
        background-color: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .user-message, .bot-message {
        margin: 10px;
        padding: 10px;
        border-radius: 5px;
        max-width: 80%;
        animation: fadeIn 0.3s ease-out;
    }

    .user-message {
        background-color: #d1e7ff;
        align-self: flex-start;
    }

    .bot-message {
        background-color: #e1f7d5;
        align-self: flex-end;
    }

    /* Chat input and send button styles */
    .chat-input-container {
        display: flex;
        align-items: center;
        width: 100%;
        margin-top: 10px;
    }

    #user-input {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        margin-right: 10px;
    }

    #send-btn {
        padding: 10px;
        border: none;
        background-color: #337ab7;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        white-space: nowrap;
    }

    #send-btn:hover {
        background-color: #0056b3;
    }

    @keyframes fadeIn {
        0% { opacity: 0; }
        100% { opacity: 1; }
    }

    /* Ensuring page content has space for the chatbox */
    .main-content {
        padding-bottom: 100px; /* Add space at the bottom for chatbox */
    }

    /* Mobile view adjustments */
    @media (max-width: 768px) {
        .chatbox {
            left: 0;  /* Adjust for smaller screens */
            width: 100%; /* Full width on mobile */
            max-width: 100%;
            padding: 15px;
        }

        #user-input {
            width: 60%; /* Input width for mobile */
        }

        #send-btn {
            width: 30%; /* Adjust button width for mobile */
        }
    }
</style>

{% endblock %}
